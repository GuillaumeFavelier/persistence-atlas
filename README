DATA DISCLAIMER
===
The data sets contained in this archive are the property of their copyright
owners. They are made available in this archive for research purpose only. They
should not be redistributed publicly without their owner's permission.


CODE DISCLAIMER
===
This code is provided "as is" without warranty of any kind. It is made available
under the licensing terms described in the file 'LICENSE'.


RELATED PUBLICATION
===
"Persistence Atlas for Critical Point Variability in Ensembles"
Guillaume Favelier, Noura Faraj, Brian Summa, Julien Tierny
IEEE Transactions on Visualization and Computer Graphics.
Proceedings of IEEE VIS 2018.


---


INSTRUCTIONS
===
The following instructions are for Unix environments (MacOS, Linux, etc.). For
Windows users, please follow the usual procedure to import a CMake project into
VisualStudio (please be careful though, important directory paths may need to
be changed for the program to run properly).


1) Software requirements:
==
This code requires the VTK development libraries to be installed on the system
(version 6.1 or higher). Please see http://www.vtk.org/ for installation
instructions.

A recent version of CMake (http://www.cmake.org) should be installed (tested
with version 2.8).

A recent version of Boost (http://www.boost.org/) should be installed (tested
with version 1.49.0).

A recent version of Python (http://www.python.org/) should be installed (tested
with version 3.6.3).

A recent version of SciPy (http://www.scipy.org/) should be installed (tested
with version 0.18.1).

A recent version of Numpy (http://www.numpy.org/) should be installed (tested
with version 1.12.1).

A recent version of Scikit-learn (http://www.scikit-learn.org/) should be
installed (tested with version 0.19.0).

Assuming that a Ubuntu 18.04 system is used, enter the following commands to
install the required dependencies:

$ apt-get update
$ apt-get install g++ cmake libboost-dev libvtk6-dev python3-dev \
  python3-numpy python3-scipy python3-sklearn


2) Compiling the code:
==
Enter the 'persistence-atlas' directory and type the following command (omit the "$" character):

$ mkdir build install
$ cd build

From there, enter the following commands:

$ cmake ../ttk -DCMAKE_INSTALL_PREFIX=../install

Depending on your system, you may need to tell cmake where to find
the numpy include directory by adding:
-DPYTHON_NUMPY_INCLUDE_DIR=<numpy-location>

For Ubuntu distribution such directory may be:
/usr/lib/python3/dist-packages/numpy/core/include

For Arch Linux distribution, we may need to add the following:
-DCMAKE_CXX_FLAGS=`pkg-config --cflags python3`

If you have built your own version of VTK, you can tell cmake where
to find it by adding:
-DVTK_DIR=<vtk-location>/build

Next, enter the following command to build and install:

$ make install


3) Reproducing the results from the paper:
==
Download the ZIP archive from the following website:

$ wget https://drive.google.com/open?id=1PffcEKpy7YQKF0mLtube-mh-vxPeiw3-

And extract the ZIP archive in the 'persistance-atlas' directory with:

$ unzip data.zip

Then from the directory 'persistence-atlas', enter the following command:

$ scripts/runtime.sh

You will get the total time for each use-case.

If you want to start only a specific use-case, do it with the following command:

for Vortex street:
$ scripts/vortexStreet.sh

for Isabella:
$ scripts/isabella.sh

for Starting vortex:
$ scripts/startingVortex.sh

for Sea Surface Height:
$ scripts/seaSurfaceHeight.sh

for Gaussians;
$ scripts/gaussians.sh

These commands will generate several VTK files that ParaView can load
and the results can be seen as scalar fields on these data sets:

The file pmb.* contains the persistence map of each ensemble member.
The file ldm.vtu corresponds to the distance matrix between the persistence maps.
The file sfp.vtp is the planar view of the ensemble.
The file(s) mcp_{min,max}.* represent(s) the mandatory critical points of each cluster.

For reference, log files for each of these scripts are available in 'persistence-atlas/log'.

To reproduce the figures:

figure 1c:
--
Start ParaView, select 'File > Open' and choose the file 'persistence-atlas/vortexStreet/sfp.vtp'
and click on 'Apply'.
Then click on 'sfp.vtp' in the pipeline and choose 'ClusterIdentifier' in the 'Coloring'
section in the 'Properties' tab.

figure 1d,1e,1f,1g,1h:
--
Start ParaView, select 'File > Open' and choose the file 'persistence-atlas/vortexStreet/mcp_max.vti'
and 'persistence-atlas/vortexStreet/mcp_min.vti' and click on 'Apply'.
Then click on 'mcp_max.vti' in the pipeline and apply 'Filters > Common > Threshold' on the field
'maximumComponents_cluster0', use '0' as the minimum bound in the 'Properties' tab.
Follow the same procedure on 'mcp_min.vti' on the field 'minimumComponents_cluster0'.
You can iterate on the clusters by changing the name of the fields used by the threshold
from '*_cluster0' to '*_cluster4'.

figure 3b:
--
Start ParaView, select 'File > Open' and choose the file 'persistence-atlas/gaussians/pmb.vtu'
and click on 'Apply'.
First, click on 'pmb.vtu' in the pipeline and:
To get the first row, choose any field from 'Gaussians_075' to 'Gaussians_099' in the 'Coloring'
section in the 'Properties' tab.
To get the second row choose any field from 'Gaussians_000' to 'Gaussians_024' in the 'Coloring'
section in the 'Properties' tab.
To get the last row, choose any field from 'Gaussians_025' to 'Gaussians_074' in the 'Coloring'
section in the 'Properties' tab.

figure 3c:
--
Start ParaView, select 'File > Open' and choose the file 'persistence-atlas/gaussians/ldm.vtu'
and click on 'Apply'.
Then click on 'ldm.vtu' in the pipeline and choose 'DistanceMatrix' in the 'Coloring'
section in the 'Properties' tab.

figure 3d:
--
Follow the same procedure as the one described in figure 1c but open the file
'persistence-atlas/gaussians/sfp.vtp' instead.

figure 3e:
--
Start ParaView, select 'File > Open' and choose the file 'persistence-atlas/gaussians/mcp_max.vtu'
and click on 'Apply'.
Then click on 'mcp_max.vtu' in the pipeline and apply 'Filters > Common > Threshold' on the field
'maximumComponents_cluster0', use '0' as the minimum bound in the 'Properties' tab.
Follow the same procedure for the fields 'maximumComponents_cluster1' and 'maximumComponents_cluster2'.

figure 8:
--
Start ParaView, select 'File > Open' and choose the file 'persistence-atlas/isabella/pmb.vti'
and click on 'Apply'.
For the top image: click on 'pmb.vti' in the pipeline and apply 'Filters > Common > Calculator', use 'Result1'
as 'Result Array Name' and 'velocityMag_02' as the expression. Now, select 'Result1' in the 'Coloring'
section and 'Volume' in 'Representation' section.
For the middle image: click on 'pmb.vti' in the pipeline and apply 'Filters > Common > Calculator', use 'Result2'
as 'Result Array Name' and 'velocityMag_30' as the expression. Now, select 'Result2' in the 'Coloring'
section and 'Volume' in 'Representation' section. You may need to modify the color transfer function in the
'Color Map Editor' of ParaView to get the exact same result.
For the bottom image: click on 'pmb.vti' in the pipeline and apply 'Filters > Common > Calculator', use 'Result3'
as 'Result Array Name' and 'velocityMag_48' as the expression. Now, select 'Result3' in the 'Coloring'
section and 'Volume' in 'Representation' section. You may need to modify the color transfer function in the
'Color Map Editor' of ParaView to get the exact same result.

figure 9d:
--
Follow the same procedure as the one described in figure 3c but open the file
'persistence-atlas/startingVortex/ldm.vtu' instead.

figure 9e:
--
Start ParaView, select 'File > Open' and choose the file 'persistence-atlas/startingVortex/pmb.vti'
and click on 'Apply'.
First, click on 'pmb.vti' in the pipeline and choose any field from 'vorticity_angle_02' to
'vorticity_angle_08' in the 'Coloring' section in the 'Properties' tab.

figure 9f:
--
Follow the same procedure as the one described in figure 9e but choose any field from
'vorticity_angle_38' to 'vorticity_angle_43' in the 'Coloring' section in the 'Properties' tab.

figure 10(middle):
--
Follow the same procedure as the one described in figure 1c but open the file
'persistence-atlas/startingVortex/sfp.vtp' instead.

figure 10(right):
--
Start ParaView, select 'File > Open' and choose the file 'persistence-atlas/startingVortex/mcp_max.vti'
and click on 'Apply'.
Then click on 'mcp_max.vti' in the pipeline and apply 'Filters > Common > Threshold' on the field
'maximumComponents_cluster0', use '0' as the minimum and maximum bound in the 'Properties' tab.
Follow the same procedure for the field 'maximumComponents_cluster1'.

figure 11b:
--
For the lower dimensional embedding, follow the same procedure as the one described in figure 1c but
open the file 'persistence-atlas/isabella/sfp.vtp' instead.
For the confidence regions, start ParaView, select 'File > Open' and choose the file
'persistence-atlas/isabella/mcp_max.vti' and click on 'Apply'.
Then click on 'mcp_max.vti' in the pipeline and apply 'Filters > Common > Threshold' on the field
'maximumComponents_cluster0', use '0' as the minimum and maximum bound in the 'Properties' tab.
Follow the same procedure for the fields 'maximumComponents_cluster1' and 'maximumComponents_cluster2'.

figure 12b:
--
Follow the same procedure as the one described in figure 1c but open the file
'persistence-atlas/seaSurfaceHeight/sfp.vtp' instead.

figure 12c,12d,12e,12f:
--
Start ParaView, select 'File > Open' and choose the file 'persistence-atlas/seaSurfaceHeight/mcp_max.vti'
and click on 'Apply'.
Then click on 'mcp_max.vti' in the pipeline and apply 'Filters > Common > Threshold' on the field
'maximumComponents_cluster0', use '0' as the minimum bound in the 'Properties' tab.
You can iterate on the clusters by changing the name of the fields used by the threshold
from '*_cluster0' to '*_cluster3'.


4) Program options and arguments:
==
From the directory "PersistenceAtlas/install", running the following command line will
display the program options and arguments:

$ ./bin/persistenceAtlasCmd -h
[Common]  _____ _____ _  __                       __  __    ____   ___  _  ___
[Common] |_   _|_   _| |/ /                      / /__\ \  |___ \ / _ \/ |( _ )
[Common]   | |   | | | ' /                      | |/ __| |   __) | | | | |/ _ \
[Common]   | |   | | | . \                      | | (__| |  / __/| |_| | | (_) |
[Common]   |_|   |_| |_|\_\                     | |\___| | |_____|\___/|_|\___/
[Common]                                         \_\  /_/
[Common] Welcome!
[CommandLine] Missing mandatory argument:
[CommandLine]   -i <{Input data-sets (*.vti, *vtu, *vtp)}>
[CommandLine]
[CommandLine] Usage:
[CommandLine]   ./bin/persistenceAtlasCmd
[CommandLine] Argument(s):
[CommandLine]   [-d <Global debug level (default: 3)>]
[CommandLine]   [-t <Thread number (default: 16)>]
[CommandLine]   [-numberOfClusters <Force number of clusters (-1 for auto-detection) (default: -1)>]
[CommandLine]   [-critical <Critical point type (0: min, 1: max, 2: both) (default: 1)>]
[CommandLine]   [-threshold <Persistence threshold (default: 0.01)>]
[CommandLine]   [-spread <Persistence spread (standard deviation) (default: 0.1)>]
[CommandLine]   [-numberOfNeighbors <Number Of Neighbors (default: 5)>]
[CommandLine]   [-mcpThreshold <Persistence threshold in MandatoryCriticalPoints module (default: 0)>]
[CommandLine]   -i <{Input data-sets (*.vti, *vtu, *vtp)}>
[CommandLine]   [-o <Output file name base (no extension) (default: `output')>]
[CommandLine] Option(s):


5) Using other data-sets:
==
These plugins use VTK Unstructured Grid (vtu) or VTK Image Data (vti) files.
In the case of an image data, an implicit triangulation is built.

The scalar fields must be associated to the points.
